// ===========================
// ๐ง ุจุงุฑฺฏุฐุงุฑ ูุชุบุฑูุง ูุญุท
// ===========================
// ุงู ูุงู ุจุงุฏ ุฏุฑ ุฑุดู ูพุฑูฺู ุจุงุดุฏ ู ุดุงูู ููุงุฏุฑ ุญุณุงุณ ูุซู PORTุ MONGO_URI ู JWT_SECRET ุจุงุดุฏ.
import dotenv from 'dotenv';
dotenv.config(); // ููุงุฏุฑ ุฑุง ูุงุฑุฏ process.env ูโฺฉูุฏ

// ===========================
// ๐ฆ ูุงุฑุฏ ฺฉุฑุฏู ฺฉุชุงุจุฎุงููโูุง
// ===========================
import mongoose from 'mongoose'; // ODM ุจุฑุง ุงุชุตุงู ู ูุฏุฑุช MongoDB
import app from './src/app.js'; // ุงูพูฺฉุดู Express ูุง

// ===========================
// โ๏ธ ุฎูุงูุฏู ุชูุธูุงุช ุงุฒ .env
// ===========================
const PORT = process.env.PORT || 3000; // ูพูุฑุช ฺฉู ุณุฑูุฑ ุฑู ุขู ุงุฌุฑุง ูโุดูุฏ
const MONGO_URI = process.env.MONGO_URI || 'mongodb://localhost:27017/pink'; // ุขุฏุฑุณ ุฏุชุงุจุณ

// ===========================
// ๐ก ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB
// ===========================
console.log('โณ ุชูุงุด ุจุฑุง ุงุชุตุงู ุจู ุฏุชุงุจุณ ...');
mongoose.connect(MONGO_URI)
  .then(() => {
    console.log('โ ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB ุจุง ููููุช ุจุฑูุฑุงุฑ ุดุฏ.');
    console.log(`๐ ูุงู ุฏุชุงุจุณ: ${mongoose.connection.name}`);
    console.log(`๐๏ธ ูุงุณุช: ${mongoose.connection.host}`);
    
    // ===========================
    // ๐ ุงุฌุฑุง ุณุฑูุฑ Express
    // ===========================
    app.listen(PORT, () => {
      console.log(`\n๐ ุณุฑูุฑ ุจุง ููููุช ุฑุงูโุงูุฏุงุฒ ุดุฏ`);
      console.log(`๐ ุขุฏุฑุณ:   http://localhost:${PORT}`);
      console.log(`๐ ูุญุท:  ${process.env.NODE_ENV || 'development'}\n`);
      console.log('๐ก ุจุฑุง ุจุฑุฑุณ ุณูุงูุช ุณุฑูุฑ ูโุชูุงูุฏ ุจู ูุณุฑ /health ุจุฑูุฏ.');
    });
  })
  .catch((err) => {
    console.error('โ ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB:');
    console.error(`๐ ูพุงู ุฎุทุง: ${err.message}`);
    console.error('๐๏ธ ูุทูุงู ุจุฑุฑุณ ฺฉูุฏ ฺฉู MongoDB ุฏุฑ ุญุงู ุงุฌุฑุงุณุช ู MONGO_URI ุตุญุญ ุงุณุช.');
    process.exit(1); // ุฎุฑูุฌ ุงุฒ ุจุฑูุงูู ุฏุฑ ุตูุฑุช ุฎุทุง ุฌุฏ
  });

// ๐ ูฺฉุชู: ฺฏุฒููโูุง useNewUrlParser ู useUnifiedTopology ุฏุฑ Mongoose 8 ูพุดโูุฑุถ ูุนุงู ูุณุชูุฏ ู ูุงุฒ ุจู ุงูุฒูุฏู ุขูโูุง ูุณุช.
